<?php

/**
 * @file
 * Customizations of the menu.
 */

/**
 * Implements hook_menu_attribute_info().
 */
function nas_menu_menu_attribute_info_alter(array &$attributes) {
  // Add a Tabindex attribute.
  $attributes['liclass'] = array(
    'label' => t('List item class'),
    'description' => t('Specifies class of LI element.'),
  );

  // Remove the Access Key attribute.
  foreach (array('accesskey', 'title', 'id', 'name', 'rel', 'style', 'target') as $key) {
    unset($attributes[$key]);
  }
}

/**
 * Implements hook_ctools_plugin_directory().
 */
function nas_menu_ctools_plugin_directory($owner, $plugin_type) {
  if ($owner == 'ctools' && $plugin_type == 'content_types') {
    return 'plugins/' . $plugin_type;
  }
}

/**
 * Implements hook_theme().
 */
function nas_menu_theme() {
  return array(
    'nas_small_header' => array(
      'arguments' => array('menu_tree' => NULL),
      'template' => 'nas-small-header',
    ),
    'nas_don_t_miss' => array(
      'arguments' => array('items' => NULL),
      'template' => 'templates/nas-don-t-miss',
    ),
    'nas_big_header' => array(
      'arguments' => array(
        'items' => NULL,
        'frontpage_link' => NULL,
        ),
      'template' => 'templates/nas-big-header',
    ),
  );
}

/**
 * Preprocess function for nas-small-header.tpl.php
 */
function template_nas_small_header(&$vars) {
  $vars['frontpage_url'] = url('<front>');
  $vars['site_name'] = check_plain(variable_get('site_name'));

  $menu_tree = $vars['menu_tree'];

  $items = array();
  foreach ($menu_tree as $menu_item) {
    $item = array(
      'li_class' => isset($menu_item['link']['options']['attributes']['liclass']) ? ' ' . $menu_item['link']['options']['attributes']['liclass'] : '',
      'a_class' => isset($menu_item['link']['options']['attributes']['class']) ? ' ' . implode(' ', $menu_item['link']['options']['attributes']['class']) : '',
      'url' => url($menu_item['link']['link_path']),
      'title' => check_plain($menu_item['link']['link_title']),
    );

    $item['#below'] = array();
    if (!empty($menu_item['below'])) {
      foreach ($menu_item['below'] as $sub_menu_item) {
        $item['#below'][] = array(
          'li_class' => isset($sub_menu_item['link']['options']['attributes']['liclass']) ? ' ' . $sub_menu_item['link']['options']['attributes']['liclass'] : '',
          'a_class' => isset($sub_menu_item['link']['options']['attributes']['class']) ? ' ' . implode(' ', $sub_menu_item['link']['options']['attributes']['class']) : '',
          'url' => url($sub_menu_item['link']['link_path']),
          'title' => check_plain($sub_menu_item['link']['link_title']),
        );
      }
    }

    $items[] = $item;
  }

  $vars['items'] = $items;
}