<?php

/**
 * @file
 * Solr related customizations.
 */

/**
 * Implements hook_entity_load().
 */
function nas_solr_entity_load($entities, $type) {
  // Variable nas_environment is set in settings.php of demo and staging sites.
  $solr_core = variable_get('solr_core', '');
  if ($type == 'search_api_server' && !empty($solr_core)) {
    foreach ($entities as &$entity) {
      $entity->options['path'] = '/solr/' . $solr_core;
      $entity->enabled = TRUE;
    }
  }

  // Use local server for all CI environments.
  if ($type == 'search_api_index' && !isset($_ENV['AH_SITE_ENVIRONMENT'])) {
    $indexes = array(
      'default_node_index',
      'page_manager_pages',
    );

    foreach ($entities as &$entity) {
      if (!in_array($entity->machine_name, $indexes)) {
        continue;
      }
      $entity->server = 'solr_4_x';
      $entity->enabled = TRUE;
    }
  }
}
